local player = game.Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local hrp = character:WaitForChild("HumanoidRootPart")
local flying = false
local speed = 50  -- Default flight speed
local walkSpeed = 16  -- Default walking speed
local height = 10  -- Default height (adjustable during flight)
local isInvisible = false
local noClipActive = false

-- Flight and Speed Control
local function startFlying()
    if flying then return end
    flying = true
    
    -- Disable gravity to simulate flying
    humanoid.PlatformStand = true
    local bodyVelocity = Instance.new("BodyVelocity")
    bodyVelocity.MaxForce = Vector3.new(40000, 40000, 40000)
    bodyVelocity.Velocity = Vector3.new(0, 0, 0)
    bodyVelocity.Parent = hrp

    -- Flight controls: Use WASD or arrow keys for movement
    local userInputService = game:GetService("UserInputService")
    userInputService.InputBegan:Connect(function(input)
        if input.KeyCode == Enum.KeyCode.Space then
            bodyVelocity.Velocity = Vector3.new(0, height, 0)  -- Going up
        elseif input.KeyCode == Enum.KeyCode.S then
            bodyVelocity.Velocity = Vector3.new(0, 0, -speed)  -- Moving backwards
        elseif input.KeyCode == Enum.KeyCode.W then
            bodyVelocity.Velocity = Vector3.new(0, 0, speed)  -- Moving forwards
        elseif input.KeyCode == Enum.KeyCode.A then
            bodyVelocity.Velocity = Vector3.new(-speed, 0, 0)  -- Moving left
        elseif input.KeyCode == Enum.KeyCode.D then
            bodyVelocity.Velocity = Vector3.new(speed, 0, 0)  -- Moving right
        end
    end)
end

local function stopFlying()
    if not flying then return end
    flying = false

    -- Enable gravity and stop flight
    humanoid.PlatformStand = false
    hrp:FindFirstChildOfClass("BodyVelocity"):Destroy()
end

-- Toggle Invisibility
local function toggleInvisibility()
    if isInvisible then
        -- Make player visible again
        character:FindFirstChild("Head").Transparency = 0
        for _, part in pairs(character:GetChildren()) do
            if part:IsA("BasePart") then
                part.Transparency = 0
            end
        end
    else
        -- Make player invisible
        character:FindFirstChild("Head").Transparency = 1
        for _, part in pairs(character:GetChildren()) do
            if part:IsA("BasePart") then
                part.Transparency = 1
            end
        end
    end
    isInvisible = not isInvisible
end

-- No-Clip (pass through walls)
local function toggleNoClip()
    noClipActive = not noClipActive
    if noClipActive then
        humanoid.PlatformStand = true
        -- Disable collision with the world
        for _, part in pairs(character:GetChildren()) do
            if part:IsA("BasePart") then
                part.CanCollide = false
            end
        end
    else
        humanoid.PlatformStand = false
        -- Re-enable collision with the world
        for _, part in pairs(character:GetChildren()) do
            if part:IsA("BasePart") then
                part.CanCollide = true
            end
        end
    end
end

-- Speed Hack (change walk speed)
local function setWalkSpeed(newSpeed)
    humanoid.WalkSpeed = newSpeed
end

-- UI Elements to Control Features
local screenGui = Instance.new("ScreenGui")
screenGui.Parent = player:WaitForChild("PlayerGui")

-- Create Flight Button
local flightButton = Instance.new("TextButton")
flightButton.Size = UDim2.new(0, 200, 0, 50)
flightButton.Position = UDim2.new(0, 0, 0, 0)
flightButton.Text = "Toggle Flight"
flightButton.Parent = screenGui
flightButton.MouseButton1Click:Connect(function()
    if flying then
        stopFlying()
    else
        startFlying()
    end
end)

-- Create Invisibility Button
local invisibilityButton = Instance.new("TextButton")
invisibilityButton.Size = UDim2.new(0, 200, 0, 50)
invisibilityButton.Position = UDim2.new(0, 0, 0, 60)
invisibilityButton.Text = "Toggle Invisibility"
invisibilityButton.Parent = screenGui
invisibilityButton.MouseButton1Click:Connect(toggleInvisibility)

-- Create No-Clip Button
local noClipButton = Instance.new("TextButton")
noClipButton.Size = UDim2.new(0, 200, 0, 50)
noClipButton.Position = UDim2.new(0, 0, 0, 120)
noClipButton.Text = "Toggle No-Clip"
noClipButton.Parent = screenGui
noClipButton.MouseButton1Click:Connect(toggleNoClip)

-- Create Speed Control Button
local speedButton = Instance.new("TextButton")
speedButton.Size = UDim2.new(0, 200, 0, 50)
speedButton.Position = UDim2.new(0, 0, 0, 180)
speedButton.Text = "Set Speed"
speedButton.Parent = screenGui
speedButton.MouseButton1Click:Connect(function()
    local newSpeed = tonumber(game:GetService("UserInputService"):GetStringForKeyCode(Enum.KeyCode.One)) or 50
    setWalkSpeed(newSpeed)
end)
